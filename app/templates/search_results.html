{% extends "base.html" %}
{% block title %}Resultados de Pesquisa{% endblock %}
{% block additional_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='posts.css') }}">
{% endblock %}
{% block content %}
<body class="min-h-screen bg-gray-50">
	{% include 'navbar.html' %}
	<div class="flex flex-col md:flex-row md:items-start md:justify-center gap-4 w-full max-w-7xl mx-auto p-2 md:p-6">
		{% include 'lateralesquerda.html' %}
		<!-- Feed central -->
		<main class="flex-1 max-w-3xl w-full">
			<div class="mb-6">
				<h1 class="text-2xl md:text-3xl font-extrabold text-gray-900 mb-2">Resultados de Pesquisa</h1>
				<div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-lg">
					<p class="text-gray-700">
						<span class="font-semibold">Buscando por:</span> 
						<span class="text-blue-600">{{ query if query else 'N/A' }}</span>
						{% if category_filter %}
							<span class="ml-4"><span class="font-semibold">Filtro de categoria:</span> <span class="text-blue-600">({{ category_filter }})</span></span>
						{% endif %}
					</p>
					<p class="text-gray-600 text-sm mt-2">Encontrados <strong>{{ total_results }}</strong> resultado(s)</p>
				</div>
			</div>

			{% if not posts %}
				<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center">
					<i class="fas fa-search text-yellow-500 text-4xl mb-4"></i>
					<h2 class="text-xl font-semibold text-gray-800 mb-2">Nenhum resultado encontrado</h2>
					<p class="text-gray-600 mb-4">
						{% if category_filter %}
							Nenhum post encontrado com "{{ query }}" na categoria "({{ category_filter }})".
						{% else %}
							Nenhum post encontrado com "{{ query }}".
						{% endif %}
					</p>
					<p class="text-gray-500 text-sm mb-4">Tente:</p>
					<ul class="text-left inline-block text-gray-600 text-sm space-y-1">
						<li>Verificar a ortografia</li>
						<li>Usar palavras-chave diferentes</li>
						<li>Remover filtros de categoria</li>
						<li>Tentar uma busca mais geral</li>
					</ul>
					<div class="mt-6">
						<a href="/" class="inline-block px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">Voltar para Timeline</a>
					</div>
				</div>
			{% else %}
				<div id="searchPosts">
					{% for post in posts %}
					<div class="timeline-post post-container tilt-box flex flex-col md:flex-row gap-6 mb-10 p-6 rounded-lg bg-gray-100 border border-gray-200 hover:border-blue-200 cursor-pointer transition group" data-postid="{{ post.id }}" data-post-userid="{{ post.userid }}">
						<div class="flex-1 flex flex-col justify-between gap-4 min-w-0">
							<div>
								<div class="flex justify-between items-center mb-2">
									<div class="flex gap-2">
										<span class="profile-pic">
											{% if post.authoricon %}
												<img src="{{ post.authoricon }}" alt="Foto de perfil" class="object-cover w-9 h-9 rounded-full">
											{% else %}
												<i class="fa-solid fa-user"></i>
											{% endif %}
										</span>
										<a href="/usuario/{{ post.userid }}" target="_blank" rel="author" class="flex flex-col author-link">
											<span class="font-semibold text-gray-800">{{ post.author or post.authorat }}</span>
											<span class="text-gray-400 text-xs">@{{ post.authorat }}</span>
										</a>
									</div>
									<div class="flex items-center">
										<p class="text-sm text-gray-500">{{ post.created_at.strftime('%d/%m/%Y') }}</p>
										<button class="options-button pr-1 pl-5 cursor-pointer text-gray-500 hover:text-blue-700 focus:outline-none"><i class="fas fa-ellipsis-v text-lg"></i></button>
									</div>
								</div>
								<h2 class="text-xl font-bold text-gray-900 mb-2 break-words line-clamp-3">{{ post.title }}</h2>
								<div class="flex flex-wrap gap-2 mb-2">
									<span class="bg-blue-500 text-white text-xs font-semibold px-3 py-1 rounded-full">{{ post.tag.upper() }}</span>
									{% if post.optional_tags %}
										{% for tag in post.optional_tags.split(',') %}
											{% if tag.strip() %}
												<span class="bg-gray-300 text-gray-800 text-xs font-semibold px-3 py-1 rounded-full">{{ tag.strip().upper() }}</span>
											{% endif %}
										{% endfor %}
									{% endif %}
								</div>
								<div class="my-4">{% if post.image_urls %}
									<div class="image-container relative float-right w-full md:w-48 h-48 ml-5 flex items-center justify-center bg-gray-200 rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity" onclick="openModal('imageModal', '{{ post.image_urls[0] }}')">
										<img src="{{ post.image_urls[0] }}" alt="Imagem do Post" class="object-cover w-full h-full">
										{% if post.image_urls|length > 1 %}
										<div class="absolute inset-0 flex items-center justify-center">
											<span class="bg-black/60 text-white text-lg font-bold px-4 py-2 rounded-full">+{{ post.image_urls|length - 1 }}</span>
										</div>
										{% endif %}
									</div>
									{% endif %}
									<p class="post-content text-gray-700 leading-relaxed md:text-lg">{% if post.content|length > 550 %}{{ post.content[:550] }}... <a target="_blank" rel="next" href="{{ url_for('posts.view_post', post_id=post.id) }}" class="text-blue-500 hover:underline">Ler Mais</a>{% else %}{{ post.content }}{% endif %}</p>
								</div>
							</div>
							<div class="flex items-center gap-4 interactions-container">
								<button class="interaction-button like-button cursor-pointer {% if post.user_reaction == 'like_post' %}active{% endif %}" id="like{{ post.id }}Button">
									<i class="fa-solid fa-thumbs-up"></i>
									<span id="like{{ post.id }}Count">{{ post.likes }}</span>
								</button>
								<button class="interaction-button dislike-button cursor-pointer {% if post.user_reaction == 'dislike_post' %}active{% endif %}" id="dislike{{ post.id }}Button">
									<i class="fa-solid fa-thumbs-down"></i>
									<span id="dislike{{ post.id }}Count">{{ post.dislikes }}</span>
								</button>
								<div class="relative shareContainer">
									<button class="interaction-button cursor-pointer shareButton">
										<i class="fa-solid fa-share-alt"></i>
										<span>Compartilhar</span>
									</button>
									<div id="shareContextMenu{{ post.id }}" class="share-context-menu hidden">
										<button onclick="copyPostUrl('{{ post.id }}')" class="cursor-pointer">
											<i class="fa-solid fa-copy"></i>
											Copiar URL do Post
										</button>
									</div>
								</div>
								<button class="interaction-button cursor-pointer {% if post.is_saved %}active{% endif %}" id="saveButton-{{ post.id }}">
									<i class="fa-solid fa-bookmark"></i>
									<span>Salvar</span>
								</button>
							</div>
						</div>
					</div>
					{% endfor %}
				</div>
			{% endif %}

			<div class="mt-8 flex justify-center">
				<a href="/" class="inline-block px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition">Voltar para Timeline</a>
			</div>
		</main>
		{% include 'lateraldireita.html' %}
	</div>
	{% include 'popups.html' %}
</body>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='postrequests.js') }}"></script>
{% endblock %}
