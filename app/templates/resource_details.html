{% extends "base.html" %}
{% block title %}{{ resource.title }}{% endblock %}
{% block additional_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='posts.css') }}">
{% endblock %}
{% block content %}
<body>
    {% include 'navbar.html' %}
    <div class="flex flex-col md:flex-row md:items-start md:justify-center gap-4 w-full max-w-7xl mx-auto p-2 md:p-6">
        {% include 'lateralesquerda.html' %}

        <div class="w-full max-w-3xl bg-white rounded-lg shadow-2xl p-6 md:p-8">
            <div class="flex items-start justify-between gap-4">
                <h1 class="text-4xl font-extrabold mb-2">{{ resource.title }}</h1>
                {% if can_delete %}
                <div class="ml-4 flex items-center gap-2">
                    <button id="deleteResourceBtn" class="bg-red-500 text-white px-3 py-1 rounded">Deletar</button>
                </div>
                {% endif %}
            </div>
            <p class="text-gray-500 mb-6">{{ resource.created_at.strftime('%b %d, %Y') }}</p>

            {% if resource.banner_url %}
            <div class="mb-6 rounded-lg overflow-hidden bg-gray-200">
                <img src="{{ resource.banner_url }}" class="w-full object-cover h-64 rounded-md" />
            </div>
            {% endif %}

            {% if resource.youtube_url %}
            <div class="mb-6 w-full rounded-lg overflow-hidden">
                <div class="w-full aspect-w-16 aspect-h-16 bg-black rounded overflow-hidden">
                    <iframe src="{{ resource.youtube_url }}" frameborder="0" allowfullscreen class="w-full h-full"></iframe>
                </div>
            </div>
            {% endif %}

            {% if resource.attachment_urls and resource.attachment_urls | length > 0 %}
            <div class="mb-4">
                <h4 class="font-semibold mb-2">Arquivos para download</h4>
                <ul class="space-y-2">
                    {% for f in resource.attachment_urls %}
                    <li class="bg-gray-100 p-3 rounded flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            {% if f.endswith('.pdf') %}
                                <i class="fa-solid fa-file-pdf text-red-500"></i>
                            {% else %}
                                <i class="fa-solid fa-file-image text-blue-500"></i>
                            {% endif %}
                            <span class="truncate max-w-[600px]">{{ f.split('/')[-1] }}</span>
                        </div>
                        <a class="text-blue-600 hover:underline" href="{{ f }}" target="_blank">Baixar</a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <div class="post-content text-gray-700 leading-relaxed text-base md:text-lg mb-8">{{ resource.content }}</div>

            <div class="my-4 text-gray-600 text-sm">Publicado por: <a href="/usuario/{{ resource.author_user.user_id }}" class="text-blue-500 hover:underline font-semibold">{{ resource.author_user.display_name or resource.author_user.user.username }}</a></div>
        </div>

        {% include 'lateraldireita.html' %}

    </div>
    {% include 'popups.html' %}
</body>
{% endblock %}

{% block scripts %}
<script>
    {% if can_delete %}
    document.getElementById('deleteResourceBtn')?.addEventListener('click', async function () {
        if (!confirm('Tem certeza que deseja deletar este recurso? Esta ação não pode ser desfeita.')) return;
        const res = await sendApiRequest(window.location.pathname + '/delete', 'POST', {});
        if (res.success) {
            window.location.href = '/recursos';
        } else {
            alert(res.message || 'Erro ao deletar o recurso');
        }
    });
    {% endif %}
</script>
{% endblock %}
