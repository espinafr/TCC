{% extends "base.html" %}
{% block title %}Login{% endblock %}
{% block content %}
<body class="min-h-screen w-full flex items-center justify-center" style="position:relative; overflow:hidden;">
	<canvas id="rain-canvas" style="position:fixed; top:0; left:0; z-index:1;"></canvas>
	<div class="absolute inset-0 w-full h-full bg-gradient-to-b from-blue-300 to-blue-400 z-0"></div>
	<div class="flex items-center justify-center min-h-screen w-full z-10 relative">
		<div class="w-full max-w-lg bg-white/40 backdrop-blur-md rounded-3xl shadow-2xl p-10 flex flex-col items-center" style="box-shadow:0 8px 32px 0 rgba(31,38,135,0.37);">
			{% with messages = get_flashed_messages(with_categories=true) %}
				{% if messages %}
					{% for category, message in messages %}
						<div class="p-2 mb-4 text-white {{ 'bg-green-500' if category == 'success' else 'bg-red-500' }} rounded">
							{{ message }}
						</div>
					{% endfor %}
				{% endif %}
			{% endwith %}
			<div class="flex flex-col w-100 mb-6">
				<h1 class="text-2xl font-bold text-gray-800 mb-2">Login</h1>
			</div>
			<form method="POST" action="{{ url_for('authentication.login') }}" class="w-full flex flex-col gap-4">
				{{ form.hidden_tag() }}
				<div>
					{% if form.login.errors %}
						<ul class="error-message">
							{% for error in form.login.errors %}
								<li class="text-red-500">{{ error }}</li>
							{% endfor %}
						</ul>
					{% endif %}
					<input type="text" id="nameinput" name="login" class="border-none bg-white shadow-md w-full rounded-xl px-6 py-4 text-lg placeholder-gray-400 focus:ring-2 focus:ring-blue-400" placeholder="E-mail ou usuário" required>
				</div>
				<div>
					{% if form.password.errors %}
						<ul class="error-message">
							{% for error in form.password.errors %}
								<li class="text-red-500">{{ error }}</li>
							{% endfor %}
						</ul>
					{% endif %}
					<input id="passwordInput" minlength="8" maxlength="30" type="password" name="password" class="border-none bg-white shadow-md w-full rounded-xl px-6 py-4 text-lg placeholder-gray-400 focus:ring-2 focus:ring-blue-400" placeholder="Senha" required>
					<div class="flex justify-end">
						<p id="passwordInputCounter" class="text-gray-500 text-sm mt-1 hidden">0 / 30</p>
					</div>
				</div>
				<div class="flex justify-end w-full">
					<a href="#" class="text-gray-700 text-sm hover:underline">Esqueceu sua <span class="text-blue-600">senha</span>?</a>
				</div>
				<button title="Botão para entrar na conta" type="submit" class="w-full bg-gradient-to-r from-blue-400 to-blue-500 text-white text-xl font-semibold py-3 rounded-full shadow-md hover:from-blue-500 hover:to-blue-600 transition">Login</button>
			</form>
			<p class="mt-6 text-gray-800">Não tem uma conta? <a href="{{ url_for('authentication.register') }}" class="text-blue-600 hover:underline">Registre-se.</a></p>
		</div>
	</div>
	{% include 'popups.html' %}
	{% include 'navbar.html' %}
	<script>
	// Animação de chuva
	const canvas = document.getElementById('rain-canvas');
	const ctx = canvas.getContext('2d');
	let width = window.innerWidth;
	let height = window.innerHeight;
	canvas.width = width;
	canvas.height = height;

	function resizeCanvas() {
		width = window.innerWidth;
		height = window.innerHeight;
		canvas.width = width;
		canvas.height = height;
	}
	window.addEventListener('resize', resizeCanvas);


	const raindropCount = 120;
	const raindrops = [];
	const wind = 2.5; // valor positivo: vento para a direita
	for (let i = 0; i < raindropCount; i++) {
		raindrops.push({
			x: Math.random() * width,
			y: Math.random() * height,
			length: 14 + Math.random() * 18,
			speed: 4 + Math.random() * 4,
			opacity: 0.55 + Math.random() * 0.35
		});
	}

	function drawRain() {
		ctx.clearRect(0, 0, width, height);
		ctx.save();
		ctx.strokeStyle = 'rgb(230, 230, 255)';
		ctx.lineWidth = 1.5;
		ctx.lineCap = 'round';
		for (let drop of raindrops) {
			ctx.globalAlpha = drop.opacity;
			ctx.beginPath();
			ctx.moveTo(drop.x, drop.y);
			ctx.lineTo(drop.x + wind * drop.length * 0.35, drop.y + drop.length); 
			ctx.stroke();
		}
		ctx.restore();
	}

	function updateRain() {
		for (let drop of raindrops) {
			drop.x += wind * 0.7;
			drop.y += drop.speed;
			if (drop.y > height || drop.x > width + 50) {
				drop.x = Math.random() * width - 50; 
				drop.y = -drop.length;
				drop.length = 14 + Math.random() * 18;
				drop.speed = 4 + Math.random() * 4;
				drop.opacity = 0.55 + Math.random() * 0.35;
			}
		}
	}

	function animateRain() {
		drawRain();
		updateRain();
		requestAnimationFrame(animateRain);
	}

	animateRain();
	</script>
</body>
{% endblock %}