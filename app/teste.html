<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Popup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>

    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    
	<div id="reusableDropdown" class="hidden absolute bg-white border border-gray-200 rounded-md shadow-lg z-10000 py-1">
		<div id="dropdownContent">
		</div>
	</div>
	
	<div class="post-item bg-white p-4 rounded-lg shadow mb-4" data-post-id="123" data-post-author-id="456">
		<div class="flex justify-between items-center mb-2">
			<h3 class="text-xl font-semibold">Título do Post</h3>
			<button class="options-button text-gray-500 hover:text-gray-700 focus:outline-none"><i class="fas fa-ellipsis-v text-lg"></i></button>
		</div>
		<p class="text-gray-700">Conteúdo do post...</p>
	</div>

	<div class="post-item bg-white p-4 rounded-lg shadow mb-4" data-post-id="456" data-post-author-id="123">
		<div class="flex justify-between items-center mb-2">
			<h3 class="text-xl font-semibold">Outro Post</h3>
			<button class="options-button text-gray-500 hover:text-gray-700 focus:outline-none">
				<i class="fas fa-ellipsis-v text-lg"></i>
			</button>
		</div>
		<p class="text-gray-700">Mais conteúdo...</p>
	</div>

	<div class="profile-card bg-white p-6 rounded-lg shadow mb-4" data-user-id="789" data-username="john_doe">
		<div class="flex justify-between items-center mb-2">
			<h3 class="text-2xl font-bold">John Doe</h3>
			<button class="options-button text-gray-500 hover:text-gray-700 focus:outline-none">
				<i class="fas fa-ellipsis-v text-lg"></i>
			</button>
		</div>
		<p class="text-gray-700">Biografia do usuário...</p>
	</div>
	
	<script>
	// main.js ou script principal da sua página

	// Funções de ação (as mesmas que estão no final do dropdownManager.js para teste)
	function editPost(data) { console.log('editar'); }
	function deletePost(data) { console.log('deletar'); }
	function reportPost(data) { console.log('reportar'); }
	function followUser(data) { console.log('seguir'); }
	function blockUser(data) { console.log('block'); }
	function sendMessage(data) { console.log('mess'); }

	document.addEventListener('DOMContentLoaded', () => {
		document.querySelectorAll('.options-button').forEach(button => {
			button.addEventListener('click', (event) => {
				const parentElement = event.currentTarget.closest('.post-item, .profile-card'); // Encontra o pai mais próximo que identifica o item
				let options = [];
				let data = {};

				if (parentElement.classList.contains('post-item')) {
					const postId = parentElement.dataset.postId;
					const postAuthorId = parentElement.dataset.postAuthorId; // Se precisar do autor

					data = { postId: postId, postAuthorId: postAuthorId };

					// Exemplo: Opções para um post
					options = [
						{ text: 'Editar Post', action: editPost },
						{ text: 'Deletar Post', action: deletePost },
						{ text: 'Reportar', action: reportPost }
					];

					// Exemplo de lógica condicional: Se for o seu próprio post
					// if (isCurrentUser(postAuthorId)) { // isCurrentUser seria uma função sua de verificação
					//     options.unshift({ text: 'Fixar Post', action: pinPost });
					// }

				} else if (parentElement.classList.contains('profile-card')) {
					const userId = parentElement.dataset.userId;
					const username = parentElement.dataset.username;

					data = { userId: userId, username: username };

					// Exemplo: Opções para um perfil
					options = [
						{ text: 'Seguir', action: followUser },
						{ text: 'Bloquear', action: blockUser },
						{ text: 'Enviar Mensagem', action: sendMessage }
					];
					// Exemplo: Se for seu próprio perfil, mude as opções
					// if (isCurrentUser(userId)) {
					//     options = [{ text: 'Editar Perfil', action: editProfile }];
					// }
				}

				showReusableDropdown(event.currentTarget, options, data);
			});
		});
	});
	
	// dropdownManager.js (ou adicione ao seu arquivo JS existente)

	// Referência ao dropdown reutilizável e ao seu conteúdo
	const reusableDropdown = document.getElementById('reusableDropdown');
	const dropdownContent = document.getElementById('dropdownContent');
	let currentActiveButton = null; // Para rastrear qual botão abriu o dropdown
	
	function showReusableDropdown(buttonElement, options, dataAttributes = {}) {
		// Esconder dropdown existente se estiver visível
		hideReusableDropdown();

		currentActiveButton = buttonElement; // Armazena o botão ativo

		// 1. Preencher o conteúdo do dropdown
		dropdownContent.innerHTML = ''; // Limpa conteúdo anterior

		options.forEach(option => {
			const item = document.createElement('a');
			item.href = '#'; // Ou 'javascript:void(0);'
			item.className = 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 whitespace-nowrap';
			item.textContent = option.text;

			// Adiciona um listener de clique para a ação da opção
			item.addEventListener('click', (e) => {
				e.preventDefault();
				option.action(dataAttributes); // Passa os dados específicos para a ação
				hideReusableDropdown(); // Esconde o dropdown após a seleção
			});
			dropdownContent.appendChild(item);
		});

		// 2. Posicionar o dropdown
		const rect = buttonElement.getBoundingClientRect();
		reusableDropdown.style.top = `${rect.bottom + window.scrollY + 5}px`; // +5px para um pequeno espaço
		reusableDropdown.style.left = `${rect.left + window.scrollX}px`;

		// Ajustar para garantir que o dropdown não saia da tela à direita
		const dropdownWidth = reusableDropdown.offsetWidth;
		if (rect.left + dropdownWidth > window.innerWidth) {
			reusableDropdown.style.left = `${rect.right + window.scrollX - dropdownWidth}px`;
		}

		// 3. Exibir o dropdown
		reusableDropdown.classList.remove('hidden');
	}

	/**
	 * Esconde o dropdown reutilizável.
	 */
	function hideReusableDropdown() {
		reusableDropdown.classList.add('hidden');
		currentActiveButton = null;
	}

	// Fechar o dropdown ao clicar fora dele
	document.addEventListener('click', (event) => {
		// Se o clique não foi dentro do dropdown e não foi no botão que o abriu
		if (reusableDropdown && !reusableDropdown.contains(event.target) && event.target !== currentActiveButton && !currentActiveButton?.contains(event.target)) {
			hideReusableDropdown();
		}
	});

	// Fechar o dropdown ao rolar a página
	window.addEventListener('scroll', hideReusableDropdown);
	window.addEventListener('resize', hideReusableDropdown);


	// --- Exemplos de Funções de Ação (Estas iriam no seu script principal, não no dropdownManager.js) ---
	function editPost(data) {
		console.log(`Editar Post ID: ${data.postId}`);
		alert(`Editando Post ID: ${data.postId}`);
		// Lógica para abrir modal de edição, preencher form, etc.
	}

	function deletePost(data) {
		if (confirm(`Tem certeza que deseja deletar o Post ID: ${data.postId}?`)) {
			console.log(`Deletar Post ID: ${data.postId}`);
			alert(`Deletando Post ID: ${data.postId}`);
			// Lógica para enviar requisição de exclusão para o backend
		}
	}

	function reportPost(data) {
		console.log(`Reportar Post ID: ${data.postId}`);
		alert(`Reportando Post ID: ${data.postId}`);
		// Lógica para abrir modal de reporte
	}

	function followUser(data) {
		console.log(`Seguir Usuário ID: ${data.userId} (Username: ${data.username})`);
		alert(`Seguindo ${data.username}!`);
		// Lógica para enviar requisição de seguir
	}

	function blockUser(data) {
		if (confirm(`Tem certeza que deseja bloquear o Usuário ID: ${data.userId} (Username: ${data.username})?`)) {
			console.log(`Bloquear Usuário ID: ${data.userId} (Username: ${data.username})`);
			alert(`Bloqueando ${data.username}!`);
			// Lógica para enviar requisição de bloqueio
		}
	}

	function sendMessage(data) {
		console.log(`Enviar mensagem para Usuário ID: ${data.userId} (Username: ${data.username})`);
		alert(`Abrindo chat com ${data.username}.`);
		// Lógica para abrir chat
	}
	</script>
</body>
</html>